<!-- FILE: templates/main.html -->

{% extends "base.html" %}

{% block title %}Movie Review Sentiment Analysis{% endblock %}

{% block extra_css %}
<style>
    .fade-in {
        animation: fadeIn 0.5s ease-in;
    }

    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
    }

    .progress-bar-animated {
        transition: width 1s cubic-bezier(0.4, 0, 0.2, 1);
    }
</style>
{% endblock %}

{% block content %}
<!-- Hero Section with Background Pattern -->
<div class="relative bg-gradient-to-br from-primary-blue to-secondary-blue overflow-hidden">
    <!-- Background pattern with "+" symbols -->
    <div class="absolute inset-0 opacity-10">
        <div class="absolute inset-0" style="background-image: url('data:image/svg+xml,%3Csvg width=\'60\' height=\'60\' viewBox=\'0 0 60 60\' xmlns=\'http://www.w3.org/2000/svg\'%3E%3Cg fill=\'none\' fill-rule=\'evenodd\'%3E%3Cg fill=\'%23ffffff\' fill-opacity=\'1\'%3E%3Cpath d=\'M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z\'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E');"></div>
    </div>

    <div class="container mx-auto px-4 py-16 relative z-10">
        <div class="max-w-4xl mx-auto text-center text-white">
            <div class="flex justify-center mb-6">
                <span class="material-icons text-7xl">psychology</span>
            </div>
            <h1 class="text-4xl md:text-5xl font-bold mb-4">Sentiment Analysis</h1>
            <p class="text-lg md:text-xl text-blue-100 max-w-2xl mx-auto">
                Analyze movie reviews using advanced AI to understand audience sentiment and emotions
            </p>
        </div>
    </div>
</div>

<!-- Main Content -->
<div class="container mx-auto px-4 py-12">
    <div class="max-w-5xl mx-auto">
        <!-- Input Card -->
        <div class="bg-white rounded-2xl shadow-lg border border-gray-100 p-6 md:p-8 mb-8">
            <div class="mb-6">
                <label for="reviewInput" class="block text-lg font-semibold text-gray-800 mb-3">
                    <span class="material-icons align-middle mr-2 text-primary-blue">rate_review</span>
                    Enter Movie Review
                </label>
                <textarea
                    class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-primary-blue focus:ring-2 focus:ring-blue-100 outline-none transition-all resize-none text-gray-700"
                    id="reviewInput"
                    rows="6"
                    placeholder="Type or paste your movie review here...

For example: 'This film was absolutely brilliant! The cinematography was stunning and the performances were outstanding. A true masterpiece that kept me engaged from start to finish.'"
                ></textarea>
            </div>

            <!-- Action Buttons -->
            <div class="flex gap-3 flex-wrap">
                <button
                    class="flex-1 min-w-[200px] bg-primary-blue hover:bg-accent-blue text-white font-semibold py-3 px-6 rounded-xl transition-all duration-200 flex items-center justify-center gap-2 shadow-md hover:shadow-lg transform hover:-translate-y-0.5"
                    onclick="analyzeReview()"
                >
                    <span class="material-icons">psychology</span>
                    Analyze Sentiment
                </button>
                <button
                    class="bg-gray-100 hover:bg-gray-200 text-gray-700 font-semibold py-3 px-6 rounded-xl transition-all duration-200 flex items-center justify-center gap-2"
                    onclick="clearReview()"
                >
                    <span class="material-icons">refresh</span>
                    Clear
                </button>
            </div>
        </div>

        <!-- Results Section -->
        <div id="resultSection" class="hidden">
            <div class="bg-gradient-to-br from-white to-blue-50 rounded-2xl shadow-lg border border-blue-100 p-6 md:p-8">
                <!-- Header -->
                <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-8">
                    <h2 class="text-2xl font-bold text-gray-800 flex items-center gap-2">
                        <span class="material-icons text-primary-blue">analytics</span>
                        Analysis Results
                    </h2>
                    <div id="sentimentBadge" class="sentiment-badge-positive">
                        <span class="material-icons text-xl">sentiment_satisfied_alt</span>
                        <span id="sentimentText" class="font-semibold">Positive</span>
                    </div>
                </div>

                <!-- Confidence Score -->
                <div class="mb-8">
                    <div class="flex justify-between items-center mb-3">
                        <span class="text-sm font-medium text-gray-600">Confidence Score</span>
                        <span id="confidenceValue" class="text-2xl font-bold text-primary-blue">0%</span>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-3 overflow-hidden">
                        <div
                            id="progressFill"
                            class="bg-gradient-to-r from-primary-blue to-secondary-blue h-full rounded-full progress-bar-animated"
                            style="width: 0%"
                        ></div>
                    </div>
                </div>

                <!-- Text Processing Display -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                    <!-- Original Review -->
                    <div class="bg-white border-l-4 border-blue-500 rounded-lg p-4 shadow-sm">
                        <h3 class="text-sm font-semibold text-gray-600 uppercase tracking-wide mb-3 flex items-center gap-2">
                            <span class="material-icons text-blue-500 text-lg">description</span>
                            Original Review
                        </h3>
                        <p id="originalText" class="text-gray-700 leading-relaxed text-sm"></p>
                    </div>

                    <!-- Cleaned Review -->
                    <div class="bg-white border-l-4 border-green-500 rounded-lg p-4 shadow-sm">
                        <h3 class="text-sm font-semibold text-gray-600 uppercase tracking-wide mb-3 flex items-center gap-2">
                            <span class="material-icons text-green-500 text-lg">cleaning_services</span>
                            Processed Text
                        </h3>
                        <p id="cleanedText" class="text-gray-700 leading-relaxed text-sm"></p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Empty State -->
        <div id="emptyState" class="text-center py-16">
            <span class="material-icons text-gray-300 mb-4" style="font-size: 80px;">rate_review</span>
            <h3 class="text-xl font-semibold text-gray-700 mb-2">Ready to Analyze</h3>
            <p class="text-gray-500 max-w-md mx-auto">
                Enter a movie review above and click "Analyze Sentiment" to get started with AI-powered sentiment analysis
            </p>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
async function analyzeReview() {
    const reviewInput = document.getElementById('reviewInput');
    const reviewText = reviewInput.value.trim();

    if (!reviewText) {
        alert('Please enter a movie review to analyze.');
        return;
    }

    // Show loading state
    document.getElementById('emptyState').classList.add('hidden');
    const resultSection = document.getElementById('resultSection');
    resultSection.classList.remove('hidden');
    resultSection.classList.add('fade-in');

    // Show loading in the results
    document.getElementById('sentimentText').textContent = 'Analyzing...';
    document.getElementById('confidenceValue').textContent = '0%';
    document.getElementById('progressFill').style.width = '0%';
    document.getElementById('originalText').textContent = reviewText;
    document.getElementById('cleanedText').textContent = 'Processing...';

    try {
        const response = await fetch('/api/analyze-sentiment/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': getCookie('csrftoken')
            },
            body: JSON.stringify({ review: reviewText })
        });

        const data = await response.json();

        if (!response.ok) {
            throw new Error(data.error || 'Analysis failed');
        }

        displayResults(data);

    } catch (error) {
        console.error('Analysis error:', error);
        alert('Analysis service is temporarily unavailable. Please try again later.');

        // Reset on error
        resetResults();
    }
}

function displayResults(result) {
    const sentimentBadge = document.getElementById('sentimentBadge');
    const confidenceValue = document.getElementById('confidenceValue');
    const progressFill = document.getElementById('progressFill');
    const originalDisplay = document.getElementById('originalText');
    const cleanedDisplay = document.getElementById('cleanedText');

    let badgeClasses = 'px-6 py-3 rounded-full font-semibold text-sm flex items-center gap-2 shadow-md ';
    let icon = 'sentiment_satisfied_alt';
    let text = 'Positive';

    if (result.sentiment === 'positive') {
        badgeClasses += 'bg-green-100 text-green-700 border border-green-200';
        icon = 'sentiment_satisfied_alt';
        text = 'Positive';
    } else if (result.sentiment === 'negative') {
        badgeClasses += 'bg-red-100 text-red-700 border border-red-200';
        icon = 'sentiment_dissatisfied';
        text = 'Negative';
    } else {
        badgeClasses += 'bg-gray-100 text-gray-700 border border-gray-200';
        icon = 'sentiment_neutral';
        text = 'Neutral';
    }

    sentimentBadge.className = badgeClasses;
    sentimentBadge.innerHTML = `
        <span class="material-icons text-xl">${icon}</span>
        <span>${text}</span>
    `;

    const roundedConfidence = Math.round(result.confidence);
    confidenceValue.textContent = `${roundedConfidence}%`;

    setTimeout(() => {
        progressFill.style.width = `${roundedConfidence}%`;
    }, 100);

    // Display both original and cleaned text
    originalDisplay.textContent = result.original_text || 'No original text available';
    cleanedDisplay.textContent = result.cleaned_text || 'Text processing not available';
}

function clearReview() {
    // Clear the input field
    document.getElementById('reviewInput').value = '';

    // Reset all result fields to default state
    resetResults();
}

function resetResults() {
    // Hide results section
    document.getElementById('resultSection').classList.add('hidden');

    // Show empty state
    document.getElementById('emptyState').classList.remove('hidden');

    // Reset progress bar
    document.getElementById('progressFill').style.width = '0%';

    // Reset sentiment badge to default
    const sentimentBadge = document.getElementById('sentimentBadge');
    sentimentBadge.className = 'px-6 py-3 rounded-full font-semibold text-sm flex items-center gap-2 shadow-md bg-gray-100 text-gray-700 border border-gray-200';
    sentimentBadge.innerHTML = `
        <span class="material-icons text-xl">sentiment_satisfied_alt</span>
        <span id="sentimentText">Positive</span>
    `;

    // Reset confidence value
    document.getElementById('confidenceValue').textContent = '0%';

    // Clear text displays
    document.getElementById('originalText').textContent = '';
    document.getElementById('cleanedText').textContent = '';
}

// Add event listener for Enter key in textarea
document.addEventListener('DOMContentLoaded', function() {
    const reviewInput = document.getElementById('reviewInput');

    reviewInput.addEventListener('keydown', function(event) {
        if (event.key === 'Enter' && event.ctrlKey) {
            // Ctrl+Enter to analyze
            analyzeReview();
        } else if (event.key === 'Escape') {
            // Escape to clear
            clearReview();
        }
    });

    // Focus on the input when page loads
    reviewInput.focus();
});

function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}
</script>
{% endblock %}