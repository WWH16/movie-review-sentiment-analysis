<!-- FILE: templates/movies.html -->
<!-- Replace your entire movies.html file with this code -->

{% extends "base.html" %}

{% block title %}Browse Movies{% endblock %}

{% block extra_css %}
<script src="https://cdn.tailwindcss.com"></script>
<script>
    tailwind.config = {
        theme: {
            extend: {
                fontFamily: {
                    'poppins': ['Poppins', 'sans-serif'],
                },
            }
        }
    }
</script>
<style>
    body { font-family: 'Poppins', sans-serif; }

    @keyframes shimmer {
        0% { background-position: -1000px 0; }
        100% { background-position: 1000px 0; }
    }

    .skeleton {
        background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
        background-size: 1000px 100%;
        animation: shimmer 2s infinite;
    }
</style>
{% endblock %}

{% block content %}
<!-- Hero Section -->
<div class="bg-gradient-to-r from-blue-600 to-blue-800 text-white py-12">
    <div class="container mx-auto px-4">
        <div class="max-w-4xl mx-auto text-center">
            <h1 class="text-4xl md:text-5xl font-bold mb-4">Browse Movies & Series</h1>
            <p class="text-lg text-blue-100">Discover thousands of movies and TV shows</p>
        </div>
    </div>
</div>

<!-- Search Section -->
<div class="bg-white border-b border-gray-200 py-6 sticky top-0 z-10 shadow-sm">
    <div class="container mx-auto px-4">
        <div class="max-w-2xl mx-auto relative">
            <input
                type="text"
                id="searchInput"
                class="w-full px-6 py-4 pr-12 border-2 border-gray-300 rounded-full focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all text-gray-700"
                placeholder="Search movies, series, actors..."
                onkeyup="filterMovies()"
            >
            <span class="material-icons absolute right-5 top-1/2 -translate-y-1/2 text-blue-500">search</span>
        </div>
    </div>
</div>

<!-- Filter Tabs -->
<div class="bg-gray-50 border-b border-gray-200">
    <div class="container mx-auto px-4 py-4">
        <div class="flex gap-3 overflow-x-auto pb-2">
            <button class="filter-tab px-6 py-2 rounded-full font-medium whitespace-nowrap transition-all bg-blue-600 text-white" onclick="filterByCategory('all')">
                All
            </button>
            <button class="filter-tab px-6 py-2 rounded-full font-medium whitespace-nowrap transition-all bg-white text-gray-700 border border-gray-300 hover:border-blue-500" onclick="filterByCategory('movies')">
                Movies
            </button>
            <button class="filter-tab px-6 py-2 rounded-full font-medium whitespace-nowrap transition-all bg-white text-gray-700 border border-gray-300 hover:border-blue-500" onclick="filterByCategory('series')">
                TV Series
            </button>
            <button class="filter-tab px-6 py-2 rounded-full font-medium whitespace-nowrap transition-all bg-white text-gray-700 border border-gray-300 hover:border-blue-500" onclick="filterByCategory('popular')">
                Popular
            </button>
            <button class="filter-tab px-6 py-2 rounded-full font-medium whitespace-nowrap transition-all bg-white text-gray-700 border border-gray-300 hover:border-blue-500" onclick="filterByCategory('top-rated')">
                Top Rated
            </button>
        </div>
    </div>
</div>

<!-- Movies Grid -->
<div class="container mx-auto px-4 py-8">
    <!-- Loading State -->
    <div id="loadingSpinner" class="text-center py-20">
        <div class="inline-block w-12 h-12 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mb-4"></div>
        <p class="text-gray-600 font-medium">Loading movies...</p>
    </div>

    <!-- Movie Grid -->
    <div id="movieGrid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4 md:gap-6"></div>

    <!-- Empty State -->
    <div id="emptyState" class="hidden text-center py-20">
        <span class="material-icons text-gray-300 mb-4" style="font-size: 80px;">movie_filter</span>
        <p class="text-gray-600 text-lg font-medium">No movies found</p>
        <p class="text-gray-500 mt-2">Try adjusting your search or filters</p>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    const TMDB_API_KEY = '7b995d3c6fd91a2284b4ad8cb390c7b8';
    const TMDB_IMAGE_BASE = 'https://image.tmdb.org/t/p/w500';
    let allMovies = [];
    let currentFilter = 'all';

    document.addEventListener('DOMContentLoaded', loadMovies);

    async function loadMovies() {
        try {
            // TODO: Replace with Django API endpoint
            // const response = await fetch('/api/movies/');

            const response = await fetch(
                `https://api.themoviedb.org/3/movie/popular?api_key=${TMDB_API_KEY}&language=en-US&page=1`
            );
            const data = await response.json();
            allMovies = data.results;

            document.getElementById('loadingSpinner').classList.add('hidden');
            displayMovies(allMovies);
        } catch (error) {
            console.error('Error:', error);
            document.getElementById('loadingSpinner').innerHTML =
                '<p class="text-red-600 font-medium">Error loading movies</p>';
        }
    }

    function displayMovies(movies) {
        const grid = document.getElementById('movieGrid');
        const empty = document.getElementById('emptyState');

        grid.innerHTML = '';

        if (movies.length === 0) {
            grid.classList.add('hidden');
            empty.classList.remove('hidden');
            return;
        }

        grid.classList.remove('hidden');
        empty.classList.add('hidden');

        movies.forEach(movie => {
            const card = document.createElement('div');
            card.className = 'group cursor-pointer transform transition-all duration-300 hover:-translate-y-2';
            card.onclick = () => selectMovie(movie);

            const posterUrl = movie.poster_path ? `${TMDB_IMAGE_BASE}${movie.poster_path}` : null;
            const year = movie.release_date ? new Date(movie.release_date).getFullYear() : 'N/A';
            const rating = movie.vote_average ? movie.vote_average.toFixed(1) : null;

            card.innerHTML = `
                <div class="relative rounded-lg overflow-hidden shadow-md group-hover:shadow-2xl transition-shadow">
                    ${posterUrl ?
                        `<img src="${posterUrl}" alt="${movie.title}" class="w-full aspect-[2/3] object-cover" loading="lazy">` :
                        `<div class="w-full aspect-[2/3] bg-gradient-to-br from-gray-200 to-gray-300 flex flex-col items-center justify-center p-4">
                            <span class="material-icons text-gray-400 text-5xl mb-2">movie</span>
                            <span class="text-gray-600 text-sm text-center font-medium">${movie.title}</span>
                        </div>`
                    }

                    ${rating ? `
                    <div class="absolute top-2 right-2 bg-black bg-opacity-80 text-yellow-400 px-2 py-1 rounded-full text-xs font-bold flex items-center gap-1">
                        <span class="material-icons" style="font-size: 14px;">star</span>
                        ${rating}
                    </div>` : ''}

                    <div class="absolute inset-0 bg-gradient-to-t from-black via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity">
                        <div class="absolute bottom-0 left-0 right-0 p-4">
                            <h3 class="text-white font-semibold text-sm mb-1 line-clamp-2">${movie.title}</h3>
                            <p class="text-yellow-400 text-xs font-medium">${year}</p>
                        </div>
                    </div>
                </div>
            `;

            grid.appendChild(card);
        });
    }

    function selectMovie(movie) {
        console.log('Selected:', movie);
        sessionStorage.setItem('selectedMovie', JSON.stringify(movie));
        // TODO: Update with your Django review URL
        // window.location.href = `/review/${movie.id}/`;
        alert(`Selected: ${movie.title}\n\nTODO: Navigate to review page`);
    }

    function filterMovies() {
        const search = document.getElementById('searchInput').value.toLowerCase();
        const filtered = allMovies.filter(m =>
            m.title.toLowerCase().includes(search) ||
            (m.name && m.name.toLowerCase().includes(search))
        );
        displayMovies(filtered);
    }

    async function filterByCategory(category) {
        currentFilter = category;

        // Update active tab
        document.querySelectorAll('.filter-tab').forEach(tab => {
            tab.className = 'filter-tab px-6 py-2 rounded-full font-medium whitespace-nowrap transition-all bg-white text-gray-700 border border-gray-300 hover:border-blue-500';
        });
        event.target.className = 'filter-tab px-6 py-2 rounded-full font-medium whitespace-nowrap transition-all bg-blue-600 text-white';

        document.getElementById('movieGrid').classList.add('hidden');
        document.getElementById('loadingSpinner').classList.remove('hidden');

        try {
            let endpoint = '';
            switch(category) {
                case 'movies':
                    endpoint = `https://api.themoviedb.org/3/movie/popular?api_key=${TMDB_API_KEY}`;
                    break;
                case 'series':
                    endpoint = `https://api.themoviedb.org/3/tv/popular?api_key=${TMDB_API_KEY}`;
                    break;
                case 'popular':
                    endpoint = `https://api.themoviedb.org/3/trending/all/week?api_key=${TMDB_API_KEY}`;
                    break;
                case 'top-rated':
                    endpoint = `https://api.themoviedb.org/3/movie/top_rated?api_key=${TMDB_API_KEY}`;
                    break;
                default:
                    endpoint = `https://api.themoviedb.org/3/movie/popular?api_key=${TMDB_API_KEY}`;
            }

            const response = await fetch(endpoint);
            const data = await response.json();
            allMovies = data.results;

            document.getElementById('loadingSpinner').classList.add('hidden');
            displayMovies(allMovies);
        } catch (error) {
            console.error('Error:', error);
        }
    }
</script>
{% endblock %}